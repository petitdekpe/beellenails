{% extends 'base.html.twig' %}

{% block title %}Nos Prestations{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-50">
    <!-- Espaceur pour √©viter que la navbar cache le contenu -->
    <div class="pt-16 md:pt-20"></div>
    
    <div class="px-4 py-6 sm:px-6 lg:px-8 max-w-7xl mx-auto">
        
        <!-- Header -->
        <div class="mb-8">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">üíÖ Nos Prestations</h1>
                <p class="text-lg text-gray-600">D√©couvrez notre gamme compl√®te de soins pour vos ongles</p>
            </div>
        </div>

        {% if prestations is not empty %}
            <!-- Grid des prestations -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                {% for prestation in prestations %}
                    <!-- Card Prestation -->
                    <div class="bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden">
                        <!-- Image Section avec Carrousel -->
                        <div class="relative h-48">
                            {% set allImages = [] %}
                            {% if prestation.imageName %}
                                {% set allImages = allImages|merge([{'field': 'image', 'name': prestation.imageName}]) %}
                            {% endif %}
                            {% if prestation.imageName2 %}
                                {% set allImages = allImages|merge([{'field': 'image2', 'name': prestation.imageName2}]) %}
                            {% endif %}
                            {% if prestation.imageName3 %}
                                {% set allImages = allImages|merge([{'field': 'image3', 'name': prestation.imageName3}]) %}
                            {% endif %}
                            
                            {% if allImages|length > 1 %}
                                <div id="carousel-{{ prestation.id }}" class="relative h-full">
                                    <!-- Images du carrousel -->
                                    {% for imageInfo in allImages %}
                                        <div class="carousel-item-{{ prestation.id }} absolute inset-0 transition-opacity duration-700 ease-in-out{% if loop.first %} opacity-100{% else %} opacity-0{% endif %}">
                                            {% if imageInfo.field == 'image' %}
                                                <img src="{{ asset( vich_uploader_asset(prestation, 'image')) }}" class="block w-full h-full object-cover" alt="{{ prestation.title }}">
                                            {% elseif imageInfo.field == 'image2' %}
                                                <img src="{{ asset( vich_uploader_asset(prestation, 'image2')) }}" class="block w-full h-full object-cover" alt="{{ prestation.title }}">
                                            {% elseif imageInfo.field == 'image3' %}
                                                <img src="{{ asset( vich_uploader_asset(prestation, 'image3')) }}" class="block w-full h-full object-cover" alt="{{ prestation.title }}">
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                    
                                    <!-- Indicateurs -->
                                    <div class="absolute z-30 flex space-x-2 -translate-x-1/2 bottom-3 left-1/2">
                                        {% for imageInfo in allImages %}
                                            <button type="button" class="carousel-indicator-{{ prestation.id }} w-2 h-2 rounded-full bg-white/50 hover:bg-white/75{% if loop.first %} !bg-white{% endif %}" 
                                                    aria-current="{% if loop.first %}true{% else %}false{% endif %}" 
                                                    aria-label="Slide {{ loop.index }}" 
                                                    data-index="{{ loop.index0 }}">
                                            </button>
                                        {% endfor %}
                                    </div>
                                    
                                    <!-- Contr√¥les -->
                                    <button type="button" class="carousel-prev-{{ prestation.id }} absolute top-1/2 left-2 z-30 flex items-center justify-center w-8 h-8 -translate-y-1/2 cursor-pointer group focus:outline-none">
                                        <span class="inline-flex items-center justify-center w-full h-full rounded-full bg-white/30 group-hover:bg-white/50 group-focus:ring-2 group-focus:ring-white">
                                            <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 6 10">
                                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/>
                                            </svg>
                                        </span>
                                    </button>
                                    <button type="button" class="carousel-next-{{ prestation.id }} absolute top-1/2 right-2 z-30 flex items-center justify-center w-8 h-8 -translate-y-1/2 cursor-pointer group focus:outline-none">
                                        <span class="inline-flex items-center justify-center w-full h-full rounded-full bg-white/30 group-hover:bg-white/50 group-focus:ring-2 group-focus:ring-white">
                                            <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 6 10">
                                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/>
                                            </svg>
                                        </span>
                                    </button>
                                </div>
                            {% else %}
                                <!-- Image unique -->
                                <img src="{{ asset( vich_uploader_asset(prestation, 'image')) }}" class="w-full h-full object-cover" alt="{{ prestation.title }}" />
                            {% endif %}
                        </div>

                        <!-- Contenu de la carte -->
                        <div class="p-4">
                            <!-- Titre -->
                            <h3 class="font-semibold text-gray-900 mb-2 leading-snug">{{ prestation.title }}</h3>
                            
                            <!-- Informations -->
                            <div class="space-y-1 mb-4">
                                <div class="flex items-center text-sm text-gray-500">
                                    <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    {{ prestation.duration }} minutes
                                </div>
                                <div class="flex items-center text-sm font-medium text-pink-600">
                                    <svg class="w-4 h-4 mr-2 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                                    </svg>
                                    {{ prestation.price }} F CFA
                                </div>
                            </div>
                            
                            <!-- Bouton Voir plus -->
                            <button data-modal-target="modal{{ prestation.id }}" data-modal-toggle="modal{{ prestation.id }}" 
                                    class="w-full inline-flex items-center justify-center px-4 py-2 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors text-sm">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                                Voir plus
                            </button>
                        </div>
                    </div>

                    <!-- Modal -->
                    <div id="modal{{ prestation.id }}" data-modal-backdrop="static" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
                        <div class="relative p-4 w-full max-w-2xl max-h-full">
                            <!-- Contenu du modal -->
                            <div class="relative bg-white rounded-lg shadow-lg">
                                <!-- En-t√™te du modal -->
                                <div class="flex items-center justify-between p-6 border-b border-gray-200 rounded-t">
                                    <h3 class="text-xl font-semibold text-gray-900">{{ prestation.title }}</h3>
                                    <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center transition-colors" data-modal-hide="modal{{ prestation.id }}">
                                        <svg class="w-3 h-3" fill="none" viewBox="0 0 14 14">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                                        </svg>
                                        <span class="sr-only">Fermer</span>
                                    </button>
                                </div>
                                
                                <!-- Corps du modal -->
                                <div class="p-6 space-y-4">
                                    <div>
                                        <h4 class="font-medium text-gray-900 mb-2">Description</h4>
                                        <p class="text-gray-600 leading-relaxed">{{ prestation.description }}</p>
                                    </div>
                                    
                                    <div>
                                        <h4 class="font-medium text-gray-900 mb-2">Inclus dans la prestation</h4>
                                        <p class="text-gray-600 leading-relaxed">{{ prestation.inclus }}</p>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4 pt-2">
                                        <div class="flex items-center text-gray-600">
                                            <svg class="w-5 h-5 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            <span class="font-medium">Dur√©e:</span> {{ prestation.duration }} min
                                        </div>
                                        <div class="flex items-center text-pink-600 font-medium">
                                            <svg class="w-5 h-5 mr-2 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                                            </svg>
                                            <span>Prix:</span> {{ prestation.price }} F CFA
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Pied du modal -->
                                <div class="flex items-center gap-3 p-6 border-t border-gray-200 rounded-b">
                                    <a href="{{ path('app_new_rendezvous', {'prestation': prestation.id}) }}" class="flex-1">
                                        <button type="button" class="w-full inline-flex items-center justify-center px-6 py-3 bg-pink-600 hover:bg-pink-700 text-white font-medium rounded-lg transition-colors">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a4 4 0 118 0v4m-4 8a6 6 0 100-12 6 6 0 000 12zm0-8v4"/>
                                            </svg>
                                            Prendre Rendez-vous
                                        </button>
                                    </a>
                                    <a href="https://wa.me/22997853512">
                                        <button type="button" class="inline-flex items-center px-6 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded-lg transition-colors font-medium">
                                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                                            </svg>
                                            Nous contacter
                                        </button>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- √âtat vide -->
            <div class="bg-white rounded-lg shadow-sm p-12 text-center">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                </svg>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Aucune prestation disponible</h3>
                <p class="text-gray-500">Les prestations seront bient√¥t ajout√©es.</p>
            </div>
        {% endif %}
        
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialiser le carrousel pour chaque prestation
    {% for prestation in prestations %}
        {% set allImages = [] %}
        {% if prestation.imageName %}
            {% set allImages = allImages|merge([{'field': 'image', 'name': prestation.imageName}]) %}
        {% endif %}
        {% if prestation.imageName2 %}
            {% set allImages = allImages|merge([{'field': 'image2', 'name': prestation.imageName2}]) %}
        {% endif %}
        {% if prestation.imageName3 %}
            {% set allImages = allImages|merge([{'field': 'image3', 'name': prestation.imageName3}]) %}
        {% endif %}
        
        {% if allImages|length > 1 %}
        (function() {
            const prestationId = {{ prestation.id }};
            const totalSlides = {{ allImages|length }};
            let currentSlide = 0;
            
            const items = document.querySelectorAll('.carousel-item-' + prestationId);
            const indicators = document.querySelectorAll('.carousel-indicator-' + prestationId);
            const prevButton = document.querySelector('.carousel-prev-' + prestationId);
            const nextButton = document.querySelector('.carousel-next-' + prestationId);
            
            function showSlide(index) {
                // Cacher toutes les slides
                items.forEach((item, i) => {
                    item.classList.toggle('opacity-100', i === index);
                    item.classList.toggle('opacity-0', i !== index);
                });
                
                // Mettre √† jour les indicateurs
                indicators.forEach((indicator, i) => {
                    indicator.classList.toggle('!bg-white', i === index);
                    indicator.classList.toggle('bg-white/50', i !== index);
                    indicator.setAttribute('aria-current', i === index ? 'true' : 'false');
                });
                
                currentSlide = index;
            }
            
            function nextSlide() {
                const nextIndex = (currentSlide + 1) % totalSlides;
                showSlide(nextIndex);
            }
            
            function prevSlide() {
                const prevIndex = (currentSlide - 1 + totalSlides) % totalSlides;
                showSlide(prevIndex);
            }
            
            // Event listeners
            if (nextButton) {
                nextButton.addEventListener('click', nextSlide);
            }
            
            if (prevButton) {
                prevButton.addEventListener('click', prevSlide);
            }
            
            // Clics sur les indicateurs
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    showSlide(index);
                });
            });
            
            // Auto-slide (optionnel - toutes les 4 secondes)
            let autoSlideInterval = setInterval(nextSlide, 4000);
            
            // Pause auto-slide au survol
            const carousel = document.getElementById('carousel-' + prestationId);
            if (carousel) {
                carousel.addEventListener('mouseenter', () => {
                    clearInterval(autoSlideInterval);
                });
                
                carousel.addEventListener('mouseleave', () => {
                    autoSlideInterval = setInterval(nextSlide, 4000);
                });
            }
        })();
        {% endif %}
    {% endfor %}
});
</script>
{% endblock %}